<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage">
<head>
<meta xmlns="http://www.w3.org/1999/xhtml" charset="utf-8">
<meta xmlns="http://www.w3.org/1999/xhtml" name="viewport" content="width=device-width, initial-scale=1.0">
<meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="X-UA-Compatible" content="IE=edge">
<title>Frequency Correction for ADALM-PLUTO Radio in Simulink</title>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
      {
      "@context": "http://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement":
      [{
          "@type": "ListItem",
          "position": 1,

          "item": {
          "@id": "../index.html",
          "name": "Communications Toolbox Support Package for Analog Devices ADALM-Pluto Radio"
}

          } 
        ,
        {
          "@type": "ListItem",
          "position": 2,

          "item": {
          "@id": "../diagnostics.html",
          "name": "Diagnostics"
}

          }]
      }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "VisibleBreadcrumbs",

        "itemListElement":
        [
        "diagnostics"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "DigitalDocument",
          "headline": "Frequency Correction for ADALM-PLUTO Radio in Simulink",
          "description": "Synchronize both the baseband sample rate and the center frequency of two PlutoSDRs by using the Frequency correction parameter of the ADALM-PLUTO Radio Receiver block.",
          "thumbnailURL": "../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_01.png",
          "genre": "Script",
          "isBasedOn": {
          "@type": "Product",
          "name": "Simulink"

        },
          "identifier": "plutoradio.FrequencyCorrectionForADALMPLUTORadioInSimulinkExample",
          "name": "FrequencyCorrectionForADALMPLUTORadioInSimulinkExample",
          "url": "frequency-correction-for-adalm-pluto-radio-in-simulink.html"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "PropertyValue",
          "name": "open_command",
          "value": "matlab:openExample('plutoradio/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample')"

        }</script><script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "ExampleSourceFiles",

        "itemListElement":
        [
        "FrequencyCorrectionForADALMPLUTORadioInSimulinkExample.m",
        "plutoradioFrequencyCorrectionRx.slx"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script><link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/bootstrap.min.css" rel="stylesheet" type="text/css">


  <meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="Content-Script-Type" content="text/javascript">
<meta xmlns="http://www.w3.org/1999/xhtml" name="toctype" itemprop="pagetype" content="fe">
<meta xmlns="http://www.w3.org/1999/xhtml" name="infotype" itemprop="infotype" content="ex">

<meta xmlns="http://www.w3.org/1999/xhtml" name="description" itemprop="description" content="This example shows how to synchronize both the baseband sample rate and the center frequency of two PlutoSDRs by using the Frequency correction parameter of the ADALM-PLUTO Radio Receiver block."><meta xmlns="http://www.w3.org/1999/xhtml" content="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_01.png" itemprop="thumbnailUrl">
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/product/scripts/jquery/jquery-latest.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/site6.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/site6_lg.css" rel="stylesheet" media="screen and (min-width: 1200px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/site6_md.css" rel="stylesheet" media="screen and (min-width: 992px) and (max-width: 1199px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/site6_sm+xs.css" rel="stylesheet" media="screen and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/site6_sm.css" rel="stylesheet" media="screen and (min-width: 768px) and (max-width: 991px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/site6_xs.css" rel="stylesheet" media="screen and (max-width: 767px)">
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/site6_offcanvas_v2.css" rel="stylesheet" type="text/css">

<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/shared/scripts/l10n.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/shared/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/shared/scripts/f1help.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/product/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/shared/scripts/mw.imageanimation.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/shared/scripts/jquery.highlight.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/product/scripts/underscore-min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/product/scripts/use_platform_screenshots.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/product/scripts/suggest.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/shared/scripts/overload.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/shared/scripts/helpservices.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/product/scripts/productfilter.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/shared/scripts/product_group.js"></script><script xmlns="http://www.w3.org/1999/xhtml" src="../includes/shared/scripts/saxonjs/SaxonJS2.rt.js"></script><script xmlns="http://www.w3.org/1999/xhtml">
            window.history.replaceState(window.location.href, null, ""); // Initialize
            window.onload = function() {    
            mystylesheetLocation = "../includes/shared/scripts/product_group-sef.json";
            mysourceLocation = "../../../docset/docset.xml";
            product_help_location = "supportpkg/plutoradio";
            pagetype = "section";
            doccentertype = "product";
            langcode = "";
            getProductFilteredList(mystylesheetLocation, mysourceLocation, product_help_location, pagetype, doccentertype, langcode);  
            }
          </script>




<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/product/scripts/jquery/jquery.mobile.custom.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/product/scripts/bootstrap.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/product/scripts/global.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/doc_center_base.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/doc_center_installed.css" rel="stylesheet" type="text/css">
<link xmlns="http://www.w3.org/1999/xhtml" href="../includes/product/css/doc_center_print.css" rel="stylesheet" type="text/css" media="print">
<script xmlns="http://www.w3.org/1999/xhtml" src="../includes/shared/equationrenderer/release/MathRenderer.js"></script>
</head>
<body id="responsive_offcanvas">
<div xmlns="http://www.w3.org/1999/xhtml" id="doc_header_spacer" class="header"></div>
<div xmlns="http://www.w3.org/1999/xhtml" class="section_header level_3"><div class="container-fluid"><div class="row" id="mobile_search_row"><div class="col-sm-6 col-md-7 has_horizontal_local_nav" id="section_header_title"><div class="section_header_content"><div class="section_header_title"><h1><a href="../../../documentation-center.html">Help Center</a></h1></div></div></div><div class="col-xs-12 col-sm-6 col-md-5" id="mobile_search"><div class="search_nested_content_container"><form id="docsearch_form" name="docsearch_form" method="get" data-release="R2023a" data-language="en" action="../../../templates/searchresults.html"><div class="input-group tokenized_search_field"><label class="sr-only">Search Help</label><input type="text" class="form-control conjoined_search" autocomplete="off" name="qdoc" placeholder="Search Help" id="docsearch"> <div class="input-group-btn"><button type="submit" name="submitsearch" id="submitsearch" class="btn icon-search btn_search_adjacent btn_search icon_16" tabindex="-1"></button></div></div></form></div><button class="btn icon-remove btn_search pull-right icon_32 visible-xs" data-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div><div class="visible-xs" id="search_actuator"><button class="btn icon-search btn_search pull-right icon_16" data-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div></div></div></div><div class="row-offcanvas row-offcanvas-left">
<div xmlns="http://www.w3.org/1999/xhtml" class="sidebar-offcanvas" id="sidebar">
<nav class="offcanvas_nav" role="navigation">
<div class="offcanvas_actuator" data-toggle="offcanvas" data-target="#sidebar" id="nav_toggle"><button type="button" class="btn"><span class="sr-only">Off-Canvas Navigation Menu Toggle
                  Off-Canvas Navigation Menu Toggle</span><span class="icon-menu"></span></button><span class="offcanvas_actuator_label" id="translation_icon-menu" tabindex="-1" aria-hidden="true"></span></div><div class="nav_list_wrapper" id="nav_list_wrapper"><nav class="offcanvas_nav" role="navigation"><ul class="nav_breadcrumb" id="ul_left_nav_ancestors"><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../../documentation-center.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Documentation Home</span></a></li></ul>
<ul class="nav_disambiguation"><li><a href="../index.html?s_tid=CRUX_lftnav">Communications Toolbox Support Package for Analog Devices ADALM-Pluto Radio</a>
</li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../diagnostics.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Diagnostics</span></a></li></ul><ul class="nav_scrollspy nav">
<li class="nav_scrollspy_function"><a href="#responsive_offcanvas">Frequency Correction for ADALM-PLUTO Radio in Simulink</a></li>
<li class="nav_scrollspy_title" id="SSPY810-section">On this page</li>
<!--ADD_REFENTRY_TITLE_HERE 11--><li><a href="#d124e7376" class="intrnllnk">Algorithm for Estimating Frequency Correction</a></li><li><a href="#d124e7542" class="intrnllnk">Set up the Transmitter and the Receiver</a></li><li><a href="#d124e7559" class="intrnllnk">Estimate the Frequency Correction Value</a></li><li><a href="#d124e7565" class="intrnllnk">Apply the Frequency Correction Value</a></li><li><a href="#d124e7603" class="intrnllnk">Verify the Results</a></li></ul>
</nav></div></nav>
<script src="../includes/product/scripts/offcanvas_v2.js"></script></div><!--END.CLASS sidebar-offcanvas-->
<div class="offcanvas_content_container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sticky_header_container"><div class="horizontal_nav"><div class="horizontal_nav_container"><div class="offcanvas_horizontal_nav"><div class="container-fluid"><div class="row"><div class="col-sm-12 hidden-xs"><nav class="navbar navbar-default" role="navigation" id="subnav"><div><ul class="nav navbar-nav crux_browse"><li id="crux_nav_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_example" class="crux_resource"><a href="../examples.html?category=diagnostics&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=diagnostics&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_block" class="crux_resource"><a href="../referencelist.html?type=block&amp;category=diagnostics&amp;s_tid=CRUX_topnav">Blocks</a></li></ul></div></nav></div><div class="visible-xs"><div class="container-fluid"><div class="row"><div class="col-xs-9"><div class="mobile_crux_nav_trigger"><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Resources<span class="icon-arrow-down icon_16"></span></button><ul class="dropdown-menu"><li id="crux_nav_mobile_documentation" class="crux_resource active">Documentation</li><li id="crux_nav_mobile_example" class="crux_resource"><a href="../examples.html?category=diagnostics&amp;s_tid=CRUX_topnav">Examples</a></li><li id="crux_nav_mobile_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=diagnostics&amp;s_tid=CRUX_topnav">Functions</a></li><li id="crux_nav_mobile_block" class="crux_resource"><a href="../referencelist.html?type=block&amp;category=diagnostics&amp;s_tid=CRUX_topnav">Blocks</a></li></ul></div></div></div><div class="col-xs-3"><div class="translate_placeholder"></div></div></div></div></div></div></div></div></div></div></div><div class="content_container" id="content_container" itemprop="content">
<div class="container-fluid">
<div class="row">
<div class="col-xs-12">

<div xmlns="http://www.w3.org/1999/xhtml" id="product_info_alert"></div><section xmlns="http://www.w3.org/1999/xhtml" id="doc_center_content" lang="en" data-language="en"><div id="pgtype-example">
<section itemprop="content"><div class="example_icon"></div><h1 class="r2023a" itemprop="title content" id="example-plutoradiofreqcalib">Frequency Correction for ADALM-PLUTO Radio in Simulink</h1><div class="examples_short_list hidden_ios_android"><div data-pane="metadata" class="panel metadata_container panel-default"><div class="panel-body metadata_content"><p class="add_margin_5">This example uses:</p><ul class="list-unstyled add_border_bottom example_product_list" itemprop="requiredprods"><li><a href="matlab:matlab.internal.language.introspective.showAddon('PLUTO')">Communications Toolbox Support Package for Analog Devices ADALM-PLUTO Radio</a></li><li><a href="matlab:matlab.internal.language.introspective.showAddon('SL')">Simulink</a></li></ul><a class="btn btn_secondary btn-block" href="matlab:openExample('plutoradio/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample')" data-ex-genre="Script">Open Script</a></div></div></div><div itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/Example" itemprop="example" class="em_example"><meta itemprop="exampleid" content="plutoradio-FrequencyCorrectionForADALMPLUTORadioInSimulinkExample"><meta itemprop="exampletitle" content="Frequency Correction for ADALMPLUTO Radio in Simulink"></div><span id="FrequencyCorrectionForADALMPLUTORadioInSimulinkExample" class="anchor_target"></span>

<p class="shortdesc">This example shows how to synchronize both the baseband sample rate and the center frequency of two PlutoSDRs by using the Frequency correction parameter of the ADALM-PLUTO Radio Receiver block.</p>

<p>The baseband sample rate and the center frequency of a PlutoSDR are physically derived from the same oscillator. Although each PlutoSDR is factory-calibrated to use appropriate PLL settings to digitally compensate for component variations of the oscillator, the compensation is imperfect because of quantization effects and changes in operating conditions (temperature in particular). Consequently, two PlutoSDRs will operate at slightly different baseband sample rates and center frequencies even if the corresponding System objects or Simulink blocks for the two PlutoSDRs use the same baseband sample rate and the same center frequency. To solve this problem, the Frequency correction parameter of the ADALM-PLUTO Radio Receiver block can be used.</p>

<p>The Frequency correction parameter specifies the parts-per-million change to the baseband sample rate and the center frequency. The default value is 0, which means that the radio will use its factory-calibrated PLL settings. In this example, we treat one PlutoSDR, the transmitter, as a source with accurate baseband sample rate and center frequency. We use the signal received by another PlutoSDR, the receiver, to estimate the right value of Frequency correction for the receiver block, and show that when Frequency correction is set appropriately, the frequency of the received tone will be very close to 80 kHz, the frequency of the transmitted tone.</p>

<p>Refer to the <a href="matlab:plutoradiodoc('sdrpluto_spsetup')" target="_blank">Getting Started</a> documentation for details on configuring your host computer to work with the PlutoSDR.</p>

<div class="procedure"><h3 class="title" id="d124e7376">Algorithm for Estimating Frequency Correction<span id="FrequencyCorrectionForADALMPLUTORadioInSimulinkExample-1" class="anchor_target"></span></h3><p>Consider a signal transmitted from one PlutoSDR to another PlutoSDR. Let <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq16211460836763137603.png" alt="$f_{c}$"></span></span> and <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq10113099801563123804.png" alt="$f_{s}$"></span></span> be the center frequency and the baseband sample rate of the transmitter. Let <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq17587346493063146970.png" alt="$f_{c'}$"></span></span> and <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq02086579205466085150.png" alt="$f_{s'}$"></span></span> be the center frequency and the baseband sample rate of the receiver. Assume that the oscillator of the transmitter has not drifted and the oscillator of the receiver has drifted by a factor <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq03845174387838694102.png" alt="$K$"></span></span>, i.e. <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq13231768777583235398.png" alt="$f_{c'} = K * f_{c}$"></span></span> and <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq02633682172194454403.png" alt="$f_{s'} = K * f_{s}$"></span></span> where <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq03845174387838694102.png" alt="$K$"></span></span> is a number very close to 1.</p><p>A tone at baseband frequency <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq17778747585972143111.png" alt="$f_{ref}$"></span></span> in the transmitted signal will appear as a tone at baseband frequency <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq18221750945443005983.png" alt="$f_{received}$"></span></span> in the receiver, where <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq03765326144210459131.png" alt="$f_{received} = {{f_{ref} + (f_{c} - K*f_c)}\over{K}}$"></span></span>. The term <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq00259616227961440253.png" alt="$(f_{c} - K*f_c)$"></span></span> in the numerator is due to the mismatch in center frequencies. The scaling factor <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq03845174387838694102.png" alt="$K$"></span></span> in the denominator is due to the mismatch in baseband sample rates. Hence, we can solve for <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq03845174387838694102.png" alt="$K$"></span></span> with <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq17778747585972143111.png" alt="$f_{ref}$"></span></span>, <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq18221750945443005983.png" alt="$f_{received}$"></span></span>, and <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq06902086386518730424.png" alt="$f_c$"></span></span>. <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq13007214228243118806.png" alt="$K = {{f_c + f_{ref}}\over{f_c + f_{received}}}$"></span></span>.</p><p>To remove the frequency offset between the transmitter and the receiver, we need to scale the baseband sample rate and the center frequency of the receiver by a factor of <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq01351067136224293669.png" alt="$1\over K$"></span></span>. Let <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq09941021013676836398.png" alt="$p$"></span></span> be the parts-per-million change to the baseband sample rate and the center frequency of the receiver. Then <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq18213544550502761077.png" alt="$1 + {p\over 10^6} = {1\over K}$"></span></span>. Therefore <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq04598202808429124844.png" alt="$p = {{f_{received} - f_{ref}}\over{f_{c} + f_{ref}}} * 10^6$"></span></span>.</p><h3 class="title" id="d124e7542">Set up the Transmitter and the Receiver<span id="FrequencyCorrectionForADALMPLUTORadioInSimulinkExample-2" class="anchor_target"></span></h3><p>We use one PlutoSDR to transmit three tones at 20, 40, and 80 kHz. The tone at 80 kHz is used to estimate the value for Frequency correction for the receiver. The tones at 20 and 40 kHz are only used to help visualize the spectrum.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#228B22">% Set up parameters and signals</span>
sampleRate = 200e3;
centerFreq = 2.42e9;
fRef = 80e3;
s1 = exp(1j*2*pi*20e3*[0:10000-1]'/sampleRate);  <span style="color:#228B22">% 20 kHz</span>
s2 = exp(1j*2*pi*40e3*[0:10000-1]'/sampleRate);  <span style="color:#228B22">% 40 kHz</span>
s3 = exp(1j*2*pi*fRef*[0:10000-1]'/sampleRate);  <span style="color:#228B22">% 80 kHz</span>
s = s1 + s2 + s3;
s = 0.6*s/max(abs(s)); <span style="color:#228B22">% Scale signal to avoid clipping in the time domain</span>

<span style="color:#228B22">% Set up the transmitter</span>
<span style="color:#228B22">% Use the default value of 0 for FrequencyCorrection, which corresponds to</span>
<span style="color:#228B22">% the factory-calibrated condition</span>
tx = sdrtx(<span style="color:#A020F0">'Pluto'</span>, <span style="color:#A020F0">'RadioID'</span>, <span style="color:#A020F0">'usb:1'</span>, <span style="color:#A020F0">'CenterFrequency'</span>, centerFreq, <span style="color:#0000FF">...</span>
           <span style="color:#A020F0">'BasebandSampleRate'</span>, sampleRate, <span style="color:#A020F0">'Gain'</span>, 0, <span style="color:#0000FF">...</span>
           <span style="color:#A020F0">'ShowAdvancedProperties'</span>, true);
<span style="color:#228B22">% Use the info method to show the actual values of various hardware-related</span>
<span style="color:#228B22">% properties</span>
txRadioInfo = info(tx)
<span style="color:#228B22">% Send signals</span>
disp(<span style="color:#A020F0">'Send 3 tones at 20, 40, and 80 kHz'</span>);
transmitRepeat(tx, s);

<span style="color:#228B22">% Open the receiver model</span>
open_system(<span style="color:#A020F0">'plutoradioFrequencyCorrectionRx'</span>)

<span style="color:#228B22">% Run the receiver. The detected frequency may be far from 80 kHz</span>
disp(<span style="color:#A020F0">'Running the receiver...'</span>);
sim(<span style="color:#A020F0">'plutoradioFrequencyCorrectionRx'</span>)
disp([<span style="color:#A020F0">'The detected frequency is '</span> num2str(peakFreq/1000) <span style="color:#A020F0">' kHz.'</span>]);
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>## Establishing connection to hardware. This process can take several seconds.

txRadioInfo = 

  struct with fields:

                     Status: 'Full information'
            CenterFrequency: 2.4200e+09
         BasebandSampleRate: 200000
                  SerialNum: '1000002355237309002300260902167028'
                       Gain: 0
       RadioFirmwareVersion: "0.30"
    ExpectedFirmwareVersion: "0.30"
            HardwareVersion: "A0"
        FrequencyCorrection: 0

Send 3 tones at 20, 40, and 80 kHz
## Establishing connection to hardware. This process can take several seconds.
## Waveform transmission has started successfully and will repeat indefinitely. 
## Call the release method to stop the transmission.
Running the receiver...
## Establishing connection to hardware. This process can take several seconds.
The detected frequency is 68.0386 kHz.
</pre></div></div></div><div class="informalfigure"><div id="d124e7552" class="mediaobject"><p><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_01.png"></p></div></div><div class="informalfigure"><div id="d124e7556" class="mediaobject"><p><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_02.png"></p></div></div><h3 class="title" id="d124e7559">Estimate the Frequency Correction Value<span id="FrequencyCorrectionForADALMPLUTORadioInSimulinkExample-3" class="anchor_target"></span></h3><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>additionalCorrection = (peakFreq - fRef) / (centerFreq + fRef) * 1e6;
</pre></div></div></div><h3 class="title" id="d124e7565">Apply the Frequency Correction Value<span id="FrequencyCorrectionForADALMPLUTORadioInSimulinkExample-4" class="anchor_target"></span></h3><p>Since <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq08779113771512125860.png" alt="$(1+{p_1}/10^6)*(1+{p_2}/10^6) = 1 + ({p_1} + {p_2} + {p_1}*{p_2}*10^{-6})/10^6$"></span></span>, applying two changes <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq13137298398265577444.png" alt="$p_1$"></span></span> and <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq03052410687656979467.png" alt="$p_2$"></span></span> successively is equivalent to applying a single change of <span class="inlineequation"><span class="inlinemediaobject"><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_eq10505066730844323654.png" alt="&#36;{p_1} + {p_2} + {p_1}*{p_2}*10^{-6}$"></span></span> with respect to the factory-calibrated condition.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>currentFrequencyCorrection = str2double( <span style="color:#0000FF">...</span>
    get_param(<span style="color:#A020F0">'plutoradioFrequencyCorrectionRx/ADALM-Pluto Radio Receiver'</span>, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'FrequencyCorrection'</span>))

newFrequencyCorrection = currentFrequencyCorrection + additionalCorrection + <span style="color:#0000FF">...</span>
    currentFrequencyCorrection*additionalCorrection*1e-6

set_param(<span style="color:#A020F0">'plutoradioFrequencyCorrectionRx/ADALM-Pluto Radio Receiver'</span>, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'FrequencyCorrection'</span>,num2str(newFrequencyCorrection,<span style="color:#A020F0">'%.12f'</span>))
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>
currentFrequencyCorrection =

     0


newFrequencyCorrection =

   -4.9426

</pre></div></div></div><h3 class="title" id="d124e7603">Verify the Results<span id="FrequencyCorrectionForADALMPLUTORadioInSimulinkExample-5" class="anchor_target"></span></h3><p>Run the receiver again. The detected frequency should be closer to 80 kHz.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>disp(<span style="color:#A020F0">'Running the receiver again...'</span>);
sim(<span style="color:#A020F0">'plutoradioFrequencyCorrectionRx'</span>)
disp([<span style="color:#A020F0">'The detected frequency is '</span> num2str(peakFreq/1000) <span style="color:#A020F0">' kHz.'</span>]);

<span style="color:#228B22">% Release the transmitter radio</span>
release(tx);
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>Running the receiver again...
## Establishing connection to hardware. This process can take several seconds.
The detected frequency is 80.04 kHz.
</pre></div></div></div><div class="informalfigure"><div id="d124e7613" class="mediaobject"><p><img src="../../../examples/plutoradio/win64/FrequencyCorrectionForADALMPLUTORadioInSimulinkExample_03.png"></p></div></div></div></section>
    </div>
<div class="modal fade" id="open-example-dialog" tabindex="-1" role="dialog" aria-labelledby="openExampleDialogLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button><h2 class="h3 modal-title">Open Example</h2></div><div class="modal-body" id="dialog-body"><p>You have a modified version of this example. Do you want to open this example with your edits?</p></div><div class="modal-footer"><a id="open-example-dialog-replace" class="btn btn_color_blue companion_btn" data-dismiss="modal">No, open this example and discard my edits</a><a id="open-example-dialog-continue" class="btn btn_color_blue" data-dismiss="modal">Yes</a></div></div></div></div>
<div class="clearfix"></div>
<div align="center" class="feedbackblock" id="mw_docsurvey"><script src="https://www.mathworks.com/help/docsurvey/docfeedback.js"></script>
<script>loadSurveyHidden();</script>
<link rel="stylesheet" href="https://www.mathworks.com/help/docsurvey/release/index-css.css" type="text/css">
<script src="https://www.mathworks.com/help/docsurvey/release/bundle.index.js"></script>

<script>initDocSurvey();</script></div></section>


</div>
</div>
</div>
</div><!--close_0960-->
<footer xmlns="http://www.w3.org/1999/xhtml" id="footer" class="bs-footer">
<div class="container-fluid">
<div class="footer">
<div class="row">
<div class="col-xs-12">
<p class="copyright">© 1994-2023 The MathWorks, Inc.</p>
<ul class="footernav"><li class="footernav_help"><a href="matlab:web(matlab.internal.licenseAgreement)">Terms of Use</a></li><li class="footernav_patents"><a href="matlab:web([matlabroot '/patents.txt'])">Patents</a></li><li class="footernav_trademarks"><a href="matlab:web([matlabroot '/trademarks.txt'])">Trademarks</a></li><li class="footernav_piracy"><a href="matlab:web([docroot '/acknowledgments.html'])">Acknowledgments</a></li></ul></div>
</div>
</div>
</div>
</footer>
</div><!--close row-offcanvas-->
</div><!--close_0970-->
</body>
</html>
